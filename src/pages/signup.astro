---
// Frontmatter script space, where you can import components or write JavaScript
---

<html>
  <head>
    <title>Signup</title>
    <link rel="stylesheet" href="/src/styles/global.css" />
  </head>
  <body class="bg-gray-100">
    <main
      class="flex flex-col items-center justify-center min-h-screen"
    >
      <div class="w-full max-w-xs p-8 bg-white rounded-lg shadow-md">
        <h1 class="mb-6 text-2xl font-bold text-center text-gray-800">
          Signup
        </h1>
        <form
          id="signupForm"
          method="POST"
          action="/api/signup"
          class="space-y-6"
        >
          <div>
            <label
              for="firstName"
              class="block text-sm font-medium text-gray-700"
              >First Name:</label
            >
            <input
              type="text"
              id="firstName"
              name="firstName"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
          </div>
          <div>
            <label
              for="lastName"
              class="block text-sm font-medium text-gray-700"
              >Last Name:</label
            >
            <input
              type="text"
              id="lastName"
              name="lastName"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
          </div>
          <div>
            <label
              for="username"
              class="block text-sm font-medium text-gray-700"
              >Username:</label
            >
            <input
              type="text"
              id="username"
              name="username"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
          </div>
          <div>
            <label
              for="email"
              class="block text-sm font-medium text-gray-700"
              >Email:</label
            >
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
          </div>
          <div>
            <label
              for="password"
              class="block text-sm font-medium text-gray-700"
              >Password:</label
            >
            <input
              type="password"
              id="password"
              name="password"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
          </div>
          <div>
            <label
              for="passwordConfirm"
              class="block text-sm font-medium text-gray-700"
              >Confirm Password:</label
            >
            <input
              type="password"
              id="passwordConfirm"
              name="passwordConfirm"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
          </div>
          <button
            type="submit"
            class="w-full px-4 py-2 text-sm font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700"
            >Signup</button
          >
        </form>
        <p class="mt-4 text-sm text-center text-gray-600">
          Already have an account? <a
            href="/login"
            class="font-medium text-blue-500 hover:text-blue-700"
            >Login</a
          >
        </p>
      </div>
    </main>
    <script>
      // Get elements with proper type assertions
      const firstNameElement = document.getElementById('firstName') as HTMLInputElement;
      const lastNameElement = document.getElementById('lastName') as HTMLInputElement;
      const emailElement = document.getElementById('email') as HTMLInputElement;
      const usernameElement = document.getElementById('username') as HTMLInputElement;
      const passwordElement = document.getElementById('password') as HTMLInputElement;
      const passwordConfirmElement = document.getElementById('passwordConfirm') as HTMLInputElement;
      const signupFormElement = document.getElementById('signupForm') as HTMLFormElement;

      // Add event listeners if elements exist
      firstNameElement?.addEventListener('blur', event => validateName(event.target as HTMLInputElement));
      lastNameElement?.addEventListener('blur', event => validateName(event.target as HTMLInputElement));
      emailElement?.addEventListener('blur', validateEmail);
      usernameElement?.addEventListener('blur', validateUsername);
      passwordElement?.addEventListener('blur', validatePasswords);
      passwordConfirmElement?.addEventListener('blur', validatePasswords);
      signupFormElement?.addEventListener('submit', validateForm);

      function validateName(nameElement: HTMLInputElement) {
        const name = nameElement.value.trim();
        const maxLength = 50; // Maximum length for names

        if (name.length === 0) {
          alert('Name cannot be empty.');
          nameElement.classList.add('invalid-input');
          return false;
        } else if (name.length > maxLength) {
          alert(`Name cannot exceed ${maxLength} characters.`);
          nameElement.classList.add('invalid-input');
          return false;
        } else {
          nameElement.classList.remove('invalid-input');
        }
        return true;
      }

      function validateEmail() {
        if (!emailElement) {
          console.error('Email element not found');
          return false;
        }

        const email = emailElement.value;
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!re.test(email)) {
          alert('Please enter a valid email address.');
          emailElement.classList.add('invalid-input');
          return false;
        } else {
          emailElement.classList.remove('invalid-input');
        }
        return true;
      }

      function validateUsername() {
        if (!usernameElement) {
          console.error('Username element not found');
          return false;
        }

        const username = usernameElement.value;
        const re = /^[a-zA-Z0-9._-]{4,32}$/;
        if (!re.test(username)) {
          alert('Username must be 4-32 characters and can only contain letters, numbers, ".", "-", and "_".');
          usernameElement.classList.add('invalid-input');
          return false;
        } else {
          usernameElement.classList.remove('invalid-input');
        }
        return true;
      }

      function validatePasswords() {
        if (!passwordElement || !passwordConfirmElement) {
          console.error('Password elements not found');
          return false;
        }

        const password = passwordElement.value;
        const passwordConfirm = passwordConfirmElement.value;
        if (password !== passwordConfirm) {
          alert('Passwords do not match.');
          passwordElement.classList.add('invalid-input');
          passwordConfirmElement.classList.add('invalid-input');
          return false;
        } else {
          passwordElement.classList.remove('invalid-input');
          passwordConfirmElement.classList.remove('invalid-input');
        }
        return true;
      }

      function validateForm(event: Event) {
        if (!firstNameElement || !lastNameElement || !emailElement || !usernameElement || !passwordElement || !passwordConfirmElement) {
          console.error('Form elements not found');
          event.preventDefault(); // Prevent form submission
          return false;
        }

        const isValidFirstName = validateName(firstNameElement);
        const isValidLastName = validateName(lastNameElement);
        const isValidEmail = validateEmail();
        const isValidUsername = validateUsername();
        const doPasswordsMatch = validatePasswords();

        if (!isValidFirstName || !isValidLastName || !isValidEmail || !isValidUsername || !doPasswordsMatch) {
          event.preventDefault(); // Prevent form submission
          return false;
        }
        return true;
      }

    </script>

  </body>
</html>
