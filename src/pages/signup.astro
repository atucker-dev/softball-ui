---
// Frontmatter script space, where you can import components or write JavaScript
---

<html>
  <head>
    <title>Signup</title>
    <link rel="stylesheet" href="/src/styles/global.css" />
    <style>
      .error-message {
        color: red;
        font-size: 0.875rem; /* 14px */
        margin-top: 0.25rem; /* 4px */
        display: none;
      }

      .invalid-input {
        border-color: red;
        box-shadow: 0 0 0 1px red;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <main class="flex flex-col items-center justify-center min-h-screen">
      <div class="w-full max-w-xs p-8 bg-white rounded-lg shadow-md">
        <h1 class="mb-6 text-2xl font-bold text-center text-gray-800">Signup</h1>
        <form id="signupForm" method="POST" action="/api/signup" class="space-y-6">
          <div>
            <label for="firstName" class="block text-sm font-medium text-gray-700">First Name:</label>
            <input
              type="text"
              id="firstName"
              name="firstName"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
            <span id="firstNameError" class="error-message"></span>
          </div>
          <div>
            <label for="lastName" class="block text-sm font-medium text-gray-700">Last Name:</label>
            <input
              type="text"
              id="lastName"
              name="lastName"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
            <span id="lastNameError" class="error-message"></span>
          </div>
          <div>
            <label for="username" class="block text-sm font-medium text-gray-700">Username:</label>
            <input
              type="text"
              id="username"
              name="username"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
            <span id="usernameError" class="error-message"></span>
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700">Email:</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
            <span id="emailError" class="error-message">Invalid email address.</span>
          </div>
          <div>
            <label for="password" class="block text-sm font-medium text-gray-700">Password:</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
            <span id="passwordError" class="error-message"></span>
          </div>
          <div>
            <label for="passwordConfirm" class="block text-sm font-medium text-gray-700">Confirm Password:</label>
            <input
              type="password"
              id="passwordConfirm"
              name="passwordConfirm"
              required
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-300"
            />
            <span id="passwordConfirmError" class="error-message"></span>
          </div>
          <button type="submit" class="w-full px-4 py-2 text-sm font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700">Signup</button>
        </form>
        <p class="mt-4 text-sm text-center text-gray-600">
          Already have an account? <a href="/login" class="font-medium text-blue-500 hover:text-blue-700">Login</a>
        </p>
      </div>
    </main>

    <script>
      const firstNameElement = document.getElementById('firstName') as HTMLInputElement | null;
      const lastNameElement = document.getElementById('lastName') as HTMLInputElement | null;
      const emailElement = document.getElementById('email') as HTMLInputElement | null;
      const usernameElement = document.getElementById('username') as HTMLInputElement | null;
      const passwordElement = document.getElementById('password') as HTMLInputElement | null;
      const passwordConfirmElement = document.getElementById('passwordConfirm') as HTMLInputElement | null;
      const signupFormElement = document.getElementById('signupForm') as HTMLFormElement | null;

      const firstNameError = document.getElementById('firstNameError') as HTMLSpanElement | null;
      const lastNameError = document.getElementById('lastNameError') as HTMLSpanElement | null;
      const emailError = document.getElementById('emailError') as HTMLSpanElement | null;
      const usernameError = document.getElementById('usernameError') as HTMLSpanElement | null;
      const passwordError = document.getElementById('passwordError') as HTMLSpanElement | null;
      const passwordConfirmError = document.getElementById('passwordConfirmError') as HTMLSpanElement | null;

      firstNameElement?.addEventListener('blur', () => validateName(firstNameElement, firstNameError));
      lastNameElement?.addEventListener('blur', () => validateName(lastNameElement, lastNameError));
      emailElement?.addEventListener('blur', () => validateEmail(emailElement, emailError));
      usernameElement?.addEventListener('blur', () => validateUsername(usernameElement, usernameError));
      passwordElement?.addEventListener('blur', () => validatePassword(passwordElement, passwordError));
      passwordConfirmElement?.addEventListener('blur', () => validatePasswordConfirm(passwordElement, passwordConfirmElement, passwordConfirmError));
      if (signupFormElement) {
        signupFormElement.addEventListener('submit', validateForm);
      } else {
        console.error('Signup form not found');
      }

      function validateName(nameElement: HTMLInputElement | null, errorElement: HTMLSpanElement | null): boolean {
        if (!nameElement || !errorElement) return false;

        const name = nameElement.value.trim();
        const maxLength = 50;

        if (name.length === 0) {
          errorElement.innerText = 'Name cannot be empty.';
          errorElement.style.display = 'block';
          nameElement.classList.add('invalid-input');
          return false;
        } else if (name.length > maxLength) {
          errorElement.innerText = `Name cannot exceed ${maxLength} characters.`;
          errorElement.style.display = 'block';
          nameElement.classList.add('invalid-input');
          return false;
        } else {
          errorElement.style.display = 'none';
          nameElement.classList.remove('invalid-input');
        }
        return true;
      }

      function validateEmail(emailElement: HTMLInputElement | null, errorElement: HTMLSpanElement | null): boolean {
        if (!emailElement || !errorElement) return false;

        const email = emailElement.value;
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!re.test(email)) {
          errorElement.innerText = 'Please enter a valid email address.';
          errorElement.style.display = 'block';
          emailElement.classList.add('invalid-input');
          return false;
        } else {
          errorElement.style.display = 'none';
          emailElement.classList.remove('invalid-input');
        }
        return true;
      }

      function validateUsername(usernameElement: HTMLInputElement | null, errorElement: HTMLSpanElement | null): boolean {
        if (!usernameElement || !errorElement) return false;

        const username = usernameElement.value;
        const re = /^[a-zA-Z0-9._-]{4,32}$/;
        if (!re.test(username)) {
          errorElement.innerText = 'Username must be 4-32 characters and can only contain letters, numbers, ".", "-", and "_".';
          errorElement.style.display = 'block';
          usernameElement.classList.add('invalid-input');
          return false;
        } else {
          errorElement.style.display = 'none';
          usernameElement.classList.remove('invalid-input');
        }
        return true;
      }

      function validatePassword(passwordElement: HTMLInputElement | null, errorElement: HTMLSpanElement | null): boolean {
        if (!passwordElement || !errorElement) return false;

        const password = passwordElement.value;
        if (password.length < 8 || password.length > 64) {
          errorElement.innerText = 'Password must be between 8 and 64 characters.';
          errorElement.style.display = 'block';
          passwordElement.classList.add('invalid-input');
          return false;
        } else {
          errorElement.style.display = 'none';
          passwordElement.classList.remove('invalid-input');
        }
        return true;
      }

      function validatePasswordConfirm(
        passwordElement: HTMLInputElement | null,
        passwordConfirmElement: HTMLInputElement | null,
        errorElement: HTMLSpanElement | null
      ): boolean {
        if (!passwordElement || !passwordConfirmElement || !errorElement) return false;

        const password = passwordElement.value;
        const passwordConfirm = passwordConfirmElement.value;

        if (password !== passwordConfirm) {
          errorElement.innerText = 'Passwords do not match.';
          errorElement.style.display = 'block';
          passwordConfirmElement.classList.add('invalid-input');
          return false; // This should prevent form submission
        } else {
          errorElement.style.display = 'none';
          passwordConfirmElement.classList.remove('invalid-input');
          return true;
        }
      }

      function validateForm(event: Event): void {
        if (
          !signupFormElement ||
          !firstNameElement ||
          !lastNameElement ||
          !emailElement ||
          !usernameElement ||
          !passwordElement ||
          !passwordConfirmElement
        ) {
          console.error('Form elements not found');
          event.preventDefault(); // Prevent form submission
          return;
        }

        const isValidFirstName = validateName(firstNameElement, firstNameError);
        const isValidLastName = validateName(lastNameElement, lastNameError);
        const isValidEmail = validateEmail(emailElement, emailError);
        const isValidUsername = validateUsername(usernameElement, usernameError);
        const isValidPassword = validatePassword(passwordElement, passwordError);
        const doPasswordsMatch = validatePasswordConfirm(passwordElement, passwordConfirmElement, passwordConfirmError);

        if (!isValidFirstName || !isValidLastName || !isValidEmail || !isValidUsername || !isValidPassword || !doPasswordsMatch) {
          event.preventDefault(); // Prevent form submission
        }
      }
    </script>
  </body>
</html>
